<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DomOutline - 高级配置示例</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
        }
        
        .controls {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #45a049;
        }
        
        .btn.stop {
            background: #f44336;
        }
        
        .btn.stop:hover {
            background: #da190b;
        }
        
        .btn.secondary {
            background: #6c757d;
        }
        
        .btn.secondary:hover {
            background: #5a6268;
        }
        
        input, select, textarea {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .card h3 {
            margin-top: 0;
            color: #333;
        }
        
        .excluded {
            background: #ffebee !important;
            border: 2px dashed #f44336 !important;
        }
        
        .highlighted {
            background: rgba(255, 229, 190, 0.4) !important;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-entry.info {
            color: #0066cc;
        }
        
        .log-entry.success {
            color: #28a745;
        }
        
        .log-entry.warning {
            color: #ffc107;
        }
        
        .log-entry.error {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DomOutline - 高级配置示例</h1>
            <p>展示高级配置选项和自定义功能</p>
        </div>
        
        <div class="controls">
            <h3>配置选项</h3>
            
            <div class="control-group">
                <label>检查器元素:</label>
                <select id="inspectorSelect">
                    <option value="auto">自动创建</option>
                    <option value="custom">自定义元素</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>排除选择器:</label>
                <input type="text" id="excludesInput" placeholder="例如: .excluded, .no-inspect" value=".excluded">
            </div>
            
            <div class="control-group">
                <label>HTML 类名:</label>
                <input type="checkbox" id="htmlClassCheck" checked>
                <span>添加 theroom 类到 HTML 元素</span>
            </div>
            
            <div class="control-group">
                <label>阻止重定向:</label>
                <input type="checkbox" id="blockRedirectionCheck">
                <span>阻止页面重定向</span>
            </div>
            
            <div class="control-group">
                <button class="btn" id="startBtn">启动检查器</button>
                <button class="btn stop" id="stopBtn">停止检查器</button>
                <button class="btn secondary" id="clearLogBtn">清空日志</button>
            </div>
        </div>
        
        <div class="content">
            <div class="card">
                <h3>可检查的元素</h3>
                <p>这些元素可以被检查器检查：</p>
                <div style="padding: 15px; background: #e8f5e8; border-radius: 4px; margin: 10px 0;">
                    <h4>正常元素</h4>
                    <p>这是一个普通的 div 元素。</p>
                    <button class="btn">普通按钮</button>
                </div>
                <ul>
                    <li>列表项 1</li>
                    <li>列表项 2</li>
                    <li>列表项 3</li>
                </ul>
            </div>
            
            <div class="card">
                <h3>排除的元素</h3>
                <p>这些元素被排除在检查之外：</p>
                <div class="excluded" style="padding: 15px; border-radius: 4px; margin: 10px 0;">
                    <h4>排除的元素</h4>
                    <p>这个元素有 .excluded 类，不会被检查。</p>
                    <button class="btn">排除的按钮</button>
                </div>
                <div class="no-inspect" style="padding: 15px; background: #fff3cd; border-radius: 4px; margin: 10px 0;">
                    <h4>不检查的元素</h4>
                    <p>这个元素有 .no-inspect 类。</p>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h3>事件日志</h3>
            <div id="log" class="log">
                <div class="log-entry info">等待启动检查器...</div>
            </div>
        </div>
    </div>

    <!-- 自定义检查器元素 -->
    <div id="customInspector" style="display: none; position: absolute; top: 0; left: 0; width: 100px; height: 100px; border: 3px solid #ff6b6b; pointer-events: none; z-index: 999999; background: rgba(255, 107, 107, 0.1);">
        <div style="position: absolute; top: -30px; left: 0; background: #ff6b6b; color: white; padding: 5px 10px; font-size: 12px; white-space: nowrap;">
            自定义检查器
        </div>
    </div>

    <!-- 引入 DomOutline 库 -->
    <script src="/dist/index.umd.js"></script>
    
    <script>
        // 高级配置示例
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearLogBtn = document.getElementById('clearLogBtn');
        const inspectorSelect = document.getElementById('inspectorSelect');
        const excludesInput = document.getElementById('excludesInput');
        const htmlClassCheck = document.getElementById('htmlClassCheck');
        const blockRedirectionCheck = document.getElementById('blockRedirectionCheck');
        const log = document.getElementById('log');
        
        // 日志功能
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        // 清空日志
        clearLogBtn.addEventListener('click', () => {
            log.innerHTML = '<div class="log-entry info">日志已清空</div>';
        });
        
        // 开始检查
        startBtn.addEventListener('click', () => {
            const config = {
                htmlClass: htmlClassCheck.checked,
                blockRedirection: blockRedirectionCheck.checked,
                excludes: excludesInput.value.split(',').map(s => s.trim()).filter(s => s),
                starting: (target, event, originTarget, depth) => {
                    addLog('检查器正在启动...', 'info');
                },
                started: (target, event, originTarget, depth) => {
                    addLog('检查器已启动', 'success');
                },
                stopping: (target, event, originTarget, depth) => {
                    addLog('检查器正在停止...', 'warning');
                },
                stopped: (target, event, originTarget, depth) => {
                    addLog('检查器已停止', 'info');
                },
                click: (target, event, originTarget, depth) => {
                    if (target) {
                        addLog(`点击了元素: ${target.tagName}${target.className ? '.' + target.className.split(' ').join('.') : ''}`, 'success');
                    }
                },
                mousemove: (target, event, originTarget, depth) => {
                    // 减少日志输出频率
                    if (target && Math.random() < 0.1) {
                        addLog(`鼠标移动到: ${target.tagName}`, 'info');
                    }
                },
                hook: (event) => {
                    // 钩子函数，可以阻止检查
                    if (event.target && event.target.classList.contains('no-inspect')) {
                        addLog('阻止检查 .no-inspect 元素', 'warning');
                        return false;
                    }
                    return true;
                }
            };
            
            // 根据选择设置检查器
            if (inspectorSelect.value === 'custom') {
                config.inspector = document.getElementById('customInspector');
                config.createInspector = false;
            } else {
                config.createInspector = true;
            }
            
            theRoom.start(config);
        });
        
        // 停止检查
        stopBtn.addEventListener('click', () => {
            theRoom.stop();
        });
        
        // 绑定键盘事件
        theRoom.on('keydown', (target, event, originTarget, depth) => {
            if (event && event.ctrlKey) {
                if (event.key === 'ArrowUp') {
                    addLog(`向上导航，深度: ${depth}`, 'info');
                } else if (event.key === 'ArrowDown') {
                    addLog(`向下导航，深度: ${depth}`, 'info');
                }
            }
        });
        
        // 初始化日志
        addLog('高级配置示例已加载', 'success');
    </script>
</body>
</html>
